<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>教你实现最简单的QQ消息item侧滑菜单 | 谢汉杰</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">教你实现最简单的QQ消息item侧滑菜单</h1><a id="logo" href="/.">谢汉杰</a><p class="description">保持愚蠢，保持饥饿</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-4-4"><div class="content_container"><div class="post"><h1 class="post-title">教你实现最简单的QQ消息item侧滑菜单</h1><div class="post-content"><p>这次跟大家介绍怎么简单的实现类似QQ消息Item的左右滑动菜单的实现。首先见效果图先:</p>
<a id="more"></a>
<p><img src="http://upload-images.jianshu.io/upload_images/925576-09d6e9d464be1176.gif?imageMogr2/auto-orient/strip" alt="show.gif"><br>这就实现了ListView或RecyclerView加载的item的View实现侧滑菜单。至于这么实现，很简单就是通过继承HorizontalScrollView，再判断滑动的距离以滑到对应的View或菜单。具体如下:<br>首先，在item的界面布局方面如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;com.example.jack.listviewitemscroll.widget.ScrollListViewItem</div><div class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;50dp&quot;&gt;</div><div class="line">    &lt;LinearLayout</div><div class="line">        android:orientation=&quot;horizontal&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;match_parent&quot;&gt;</div><div class="line">        &lt;include layout=&quot;@layout/leftbutton&quot;/&gt;</div><div class="line">        &lt;include layout=&quot;@layout/context_view&quot;/&gt;</div><div class="line">        &lt;include layout=&quot;@layout/rightbutton&quot;/&gt;</div><div class="line">    &lt;/LinearLayout&gt;</div><div class="line">&lt;/com.example.jack.listviewitemscroll.widget.ScrollListViewItem&gt;</div></pre></td></tr></table></figure></p>
<p>就是ScrollListViewItem包裹着LinearLayout里面的三个View,分别是左菜单，内容和右菜单对应的View。最为重点的就是ScrollListViewItem这个类，这就是我们继承HorizontalScrollView类所自定义的控制菜单滑动的类。<br>这个类的源码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line">public class ScrollListViewItem extends HorizontalScrollView&#123;</div><div class="line"></div><div class="line">    private static int ScreenWidth=0;</div><div class="line">    private static int MenuWidth=0;</div><div class="line">    private static int HalfMenuWidth=0;</div><div class="line">    private boolean  operateLeft=false;</div><div class="line">    private boolean operateRight=false;</div><div class="line">    private boolean once;</div><div class="line"></div><div class="line">    ViewGroup left;</div><div class="line">    ViewGroup centre;</div><div class="line">    ViewGroup right;</div><div class="line"></div><div class="line">    public ScrollListViewItem(Context context) &#123;</div><div class="line">        this(context, null);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public ScrollListViewItem(Context context, AttributeSet attrs) &#123;</div><div class="line">        super(context, attrs,0);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public ScrollListViewItem(Context context, AttributeSet attrs, int defStyleAttr) &#123;</div><div class="line">        super(context, attrs, defStyleAttr,0);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</div><div class="line">       if(!once)&#123;</div><div class="line">           LinearLayout linearLayout=(LinearLayout)getChildAt(0);</div><div class="line">           left=(ViewGroup)linearLayout.getChildAt(0);</div><div class="line">           centre=(ViewGroup)linearLayout.getChildAt(1);</div><div class="line">           right=(ViewGroup)linearLayout.getChildAt(2);</div><div class="line"></div><div class="line">           ScreenWidth= ScreenUtils.getScreenWidth(getContext());</div><div class="line">           MenuWidth=ScreenWidth/4;</div><div class="line">           HalfMenuWidth=MenuWidth/2;</div><div class="line"></div><div class="line">           left.getLayoutParams().width=MenuWidth;</div><div class="line">           centre.getLayoutParams().width=ScreenWidth;</div><div class="line">           right.getLayoutParams().width=MenuWidth;</div><div class="line">       &#125;</div><div class="line">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onLayout(boolean changed, int l, int t, int r, int b) &#123;</div><div class="line">        super.onLayout(changed, l, t, r, b);</div><div class="line">        if(changed)&#123;</div><div class="line">            this.scrollTo(MenuWidth,0);</div><div class="line">            once=true;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean onTouchEvent(MotionEvent ev) &#123;</div><div class="line">        switch(ev.getAction())&#123;</div><div class="line">            case MotionEvent.ACTION_UP:</div><div class="line">                //在左侧</div><div class="line">                if(operateLeft)&#123;</div><div class="line">                    if(getScrollX()&lt;HalfMenuWidth)&#123;</div><div class="line">                        //滑到左最末尾</div><div class="line">                        this.scrollTo(0, 0);</div><div class="line">                    &#125;else if(getScrollX()&gt;HalfMenuWidth&amp;&amp;getScrollX()&lt;MenuWidth+HalfMenuWidth)&#123;</div><div class="line">                        //滑到中间</div><div class="line">                        this.scrollTo(MenuWidth, 0);</div><div class="line">                    &#125;else&#123;</div><div class="line">                        this.scrollTo(MenuWidth * 2, 0);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                //向右侧</div><div class="line">                if(operateRight)&#123;</div><div class="line">                    if(getScrollX()&gt;MenuWidth+HalfMenuWidth)&#123;</div><div class="line">                        //滑到最右</div><div class="line">                        this.scrollTo(MenuWidth + MenuWidth, 0);</div><div class="line">                    &#125;else if(getScrollX()&gt;HalfMenuWidth&amp;&amp;getScrollX()&lt;MenuWidth+HalfMenuWidth)&#123;</div><div class="line">                        //滑到中间</div><div class="line">                        this.scrollTo(MenuWidth, 0);</div><div class="line">                    &#125;else&#123;</div><div class="line">                        //滑到最左</div><div class="line">                        this.scrollTo(0, 0);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                return true;</div><div class="line">        &#125;</div><div class="line">        return super.onTouchEvent(ev);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onScrollChanged(int l, int t, int oldl, int oldt) &#123;</div><div class="line">        super.onScrollChanged(l, t, oldl, oldt);</div><div class="line">        if(l&gt;MenuWidth)&#123;</div><div class="line">            operateLeft=false;</div><div class="line">            operateRight=true;</div><div class="line">        &#125;else&#123;</div><div class="line">            operateLeft=true;</div><div class="line">            operateRight=false;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在onMeasure()这个自定义View的测量方法里，我们首先拿到左菜单，内容，右菜单所对用的view,即left,centre,right这三个View,然后获取屏幕的宽度，动态设定菜单的宽度为屏幕宽度的四分之一，而内容的宽度就是整个屏幕的宽度，即<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">left.getLayoutParams().width=MenuWidth;</div><div class="line">centre.getLayoutParams().width=ScreenWidth;</div><div class="line">right.getLayoutParams().width=MenuWidth;</div></pre></td></tr></table></figure></p>
<p>然后我们在onLayout()方法里对这三个View进行定位，即让他滑到内容的那个View。</p>
<p>然后回调onScrollChanged(int l, int t, int oldl, int oldt)方法，当l大于菜单宽度时是右侧，当l小于菜单宽度时是右侧。(注:l是屏幕最右边到整个View最右边的距离)</p>
<p>其次就是最重要的onTouchEvent(MotionEvent ev)方法了。(注:是屏幕最右边到整个View最右边的距离).当operateLeft==true的时候,滑动在操作在左侧,当<code>getScrollX()&lt;HalfMenuWidth</code>,即在最左向右滑还不到菜单的二分之一宽度时，恢复原状，即<code>this.scrollTo(0, 0);</code>，当<code>getScrollX()&gt;HalfMenuWidth&amp;&amp;getScrollX()&lt;MenuWidth+HalfMenuWidth</code>,即最左向右滑大于菜单的二分之一宽度但却小于左菜单加右菜单一半的宽度，所以只能滑到内容区域，即<code>this.scrollTo(MenuWidth, 0);</code>，这两种情况除外都会滑到最后边的菜单，所以<code>this.scrollTo(MenuWidth * 2, 0)</code>;</p>
<p>同样的道理，当operateRight==true时，<code>getScrollX()&gt;MenuWidth+HalfMenuWidth</code>时，即在最右菜单但滑动的距离小于菜单宽度的一半，所以只能恢复原状即<code>this.scrollTo(MenuWidth + MenuWidth, 0);</code>,当<code>getScrollX()&gt;HalfMenuWidth&amp;&amp;getScrollX()&lt;MenuWidth+HalfMenuWidth</code>时，即滑动大于菜单一半但是却小于左菜单加右菜单一半的宽度，所以是内容区域，即滑动 this.scrollTo(MenuWidth, 0);，除这两种情况都是要滑到最左边的菜单，即 this.scrollTo(0, 0);。到此整个流程就讲完了。</p>
<p>最后奉上<a href="https://github.com/jack921/ListViewItemScroll" target="_blank" rel="external">源码</a></p>
</div></div></div></div><div class="pure-u-1 pure-u-md-4-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">谢汉杰.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>